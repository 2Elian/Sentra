é—®é¢˜: æ­»ä¿¡é˜Ÿåˆ—æ•°æ®æœªæ¸…ç†

é—®é¢˜åˆ†æ:
- æ¶ˆæ¯è¿›å…¥æ­»ä¿¡é˜Ÿåˆ—åï¼Œæ²¡æœ‰ä»»ä½•æ¶ˆè´¹è€…å¤„ç†
- å¯¼è‡´ä»¥ä¸‹æ•°æ®æ®‹ç•™ï¼š
    - t_document (PostgreSQL)
    - sentra_doc (MongoDB)
    - SFTPæ–‡ä»¶
    - OCRç»“æœJSON

è§£å†³æ–¹æ¡ˆ:

1. åˆ›å»ºç‹¬ç«‹æ­»ä¿¡é˜Ÿåˆ— (RabbitMQConfig.java)

- OCRæ­»ä¿¡é˜Ÿåˆ—: sentra.dlq.ocr
- KBæ„å»ºæ­»ä¿¡é˜Ÿåˆ—: sentra.dlq.kb_build
- å„è‡ªæœ‰ç‹¬ç«‹çš„Exchangeå’ŒBinding

2. åˆ›å»ºæ­»ä¿¡é˜Ÿåˆ—æ¶ˆè´¹è€… (DeadLetterConsumer.java)

åŠŸèƒ½:
- ç›‘å¬ sentra.dlq.ocr - å¤„ç†OCRå¤±è´¥ä»»åŠ¡
- ç›‘å¬ sentra.dlq.kb_build - å¤„ç†çŸ¥è¯†åº“æ„å»ºå¤±è´¥ä»»åŠ¡

æ¸…ç†é€»è¾‘:
@RabbitListener(queues = "sentra.dlq.ocr")
public void handleOcrDeadLetter(OcrTaskMessage message) {
// 1. æ›´æ–°æ–‡æ¡£çŠ¶æ€ä¸ºFAILED
// 2. è°ƒç”¨documentServiceæ¸…ç†å·²åˆ›å»ºçš„èµ„æº
// - SFTPåŸå§‹æ–‡ä»¶
// - OCRç»“æœJSON
// - MongoDBæ–‡æ¡£å†…å®¹
// - ä¿ç•™PostgreSQLè®°å½•ç”¨äºè¿½è¸ª
}

3. æ›´æ–°é‡è¯•é€»è¾‘ (OcrConsumer.java & KbBuildConsumer.java)

- å°†å¤±è´¥æ¶ˆæ¯å‘é€åˆ°å„è‡ªçš„æ­»ä¿¡é˜Ÿåˆ—
- OCR â†’ sentra.dlx.ocr
- KBæ„å»º â†’ sentra.dlx.kb_build

  ---
ğŸ“Š å®Œæ•´çš„æ•°æ®æ¸…ç†æµç¨‹

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä»»åŠ¡å¤±è´¥ (è¶…è¿‡3æ¬¡é‡è¯•)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ—        â”‚
â”‚  - sentra.dlq.ocr     â”‚
â”‚  - sentra.dlq.kb_buildâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DeadLetterConsumer  â”‚
â”‚  ç›‘å¬æ­»ä¿¡é˜Ÿåˆ—         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ‰§è¡Œæ¸…ç†æ“ä½œ         â”‚
â”‚  1. æ›´æ–°çŠ¶æ€=FAILED   â”‚
â”‚  2. åˆ é™¤SFTPæ–‡ä»¶      â”‚
â”‚  3. åˆ é™¤OCRç»“æœ       â”‚
â”‚  4. åˆ é™¤MongoDBæ•°æ®   â”‚
â”‚  5. åˆ é™¤å›¾è°±æ•°æ®      â”‚
â”‚  6. ä¿ç•™PostgreSQL    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜