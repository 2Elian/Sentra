ğŸ“Š æ•°æ®åº“é€‰å‹ï¼šPostgreSQL

é€‰æ‹©åŸå› ï¼š
1. ç»“æ„åŒ–æ•°æ®ï¼šå®ä½“ç±»å‹é…ç½®æ˜¯å…¸å‹çš„ç»“æ„åŒ–æ•°æ®ï¼Œæœ‰æ˜ç¡®çš„å­—æ®µå…³ç³»
2. äº‹åŠ¡ä¸€è‡´æ€§ï¼šéœ€è¦ä¸çŸ¥è¯†åº“è¡¨åšå…³è”æŸ¥è¯¢ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§
3. å¤æ‚æŸ¥è¯¢ï¼šæ”¯æŒæŒ‰ç§Ÿæˆ·ã€çŠ¶æ€ç­‰å¤šç»´åº¦æŸ¥è¯¢
4. å·²æœ‰åŸºç¡€ï¼šé¡¹ç›®å·²æœ‰PostgreSQLï¼Œæ— éœ€å¼•å…¥æ–°æ•°æ®åº“

  ---
ğŸ—„ï¸  æ•°æ®åº“è¡¨è®¾è®¡

1. t_entity_type_templateï¼ˆå®ä½“ç±»å‹æ¨¡æ¿è¡¨ï¼‰

- ä½œç”¨ï¼šå­˜å‚¨ä¸åŒé¢†åŸŸçš„å®ä½“ç±»å‹é…ç½®æ¨¡æ¿
- å­—æ®µï¼š
    - id - ä¸»é”®
    - tenant_id - ç§Ÿæˆ·ID
    - name - æ¨¡æ¿åç§°ï¼ˆå¦‚"åˆåŒé¢†åŸŸ"ã€"è®ºæ–‡é¢†åŸŸ"ï¼‰
    - description - æ¨¡æ¿æè¿°
    - is_system - æ˜¯å¦ä¸ºç³»ç»Ÿé¢„ç½®æ¨¡æ¿
    - is_active - æ˜¯å¦å¯ç”¨
    - åˆ›å»º/æ›´æ–°æ—¶é—´ã€åˆ›å»ºäºº/æ›´æ–°äºº

2. t_entity_type_definitionï¼ˆå®ä½“ç±»å‹å®šä¹‰è¡¨ï¼‰

- ä½œç”¨ï¼šå­˜å‚¨æ¯ä¸ªæ¨¡æ¿ä¸‹çš„å…·ä½“å®ä½“ç±»å‹
- å­—æ®µï¼š
    - id - ä¸»é”®
    - template_id - æ‰€å±æ¨¡æ¿IDï¼ˆå¤–é”®ï¼‰
    - entity_code - å®ä½“ç¼–ç ï¼ˆå¦‚ContractPartyï¼‰
    - entity_name - å®ä½“åç§°ï¼ˆå¦‚åˆåŒä¸»ä½“ï¼‰
    - entity_description - å®ä½“æè¿°ï¼ˆå¦‚åˆåŒä¸»ä½“ï¼ˆç”²ä¹™æ–¹ï¼‰ï¼‰
    - display_order - æ˜¾ç¤ºé¡ºåº

3. ç³»ç»Ÿé¢„ç½®æ•°æ®

- åˆåŒé¢†åŸŸæ¨¡æ¿ï¼ˆsys_template_contractï¼‰ï¼š
    - åŒ…å«18ä¸ªå®ä½“ç±»å‹ï¼šå‚ä¸æ–¹ï¼ˆContractParty, RelatedParty, Person, Organizationï¼‰
    - æ ‡çš„ç‰©ï¼ˆContract, ProductService, RightObligation, IntellectualPropertyï¼‰
    - æ ¸å¿ƒæ¡æ¬¾ï¼ˆAmount, DateTerm, Location, Condition, BreachClauseï¼‰
    - æ—¶ç©ºä¸åº¦é‡ï¼ˆSpecificTime, TimeSpan, SpecificLocation, Currency, Unitï¼‰
- è®ºæ–‡é¢†åŸŸæ¨¡æ¿ï¼ˆsys_template_paperï¼‰ï¼š
    - åŒ…å«8ä¸ªå®ä½“ç±»å‹ï¼šAuthor, Institution, Publication, Keyword, Method, Dataset, Metric, Result
 ---
ğŸ”§ æ ¸å¿ƒåŠŸèƒ½å®ç°

1. å®ä½“ç±»

- EntityTypeTemplate.java - æ¨¡æ¿å®ä½“
- EntityTypeDefinition.java - å®ä½“ç±»å‹å®šä¹‰å®ä½“

2. DTOç±»

- EntityTypeTemplateCreateRequest.java - åˆ›å»ºè¯·æ±‚
- EntityTypeTemplateResponse.java - å“åº”DTOï¼ˆåŒ…å«å®ä½“ç±»å‹åˆ—è¡¨ï¼‰
- EntityTypeDefinitionRequest.java - å®ä½“ç±»å‹å®šä¹‰è¯·æ±‚
- EntityTypeDefinitionResponse.java - å®ä½“ç±»å‹å®šä¹‰å“åº”

3. Serviceå±‚

- IEntityTypeTemplateService.java - æ¨¡æ¿æœåŠ¡æ¥å£
- EntityTypeTemplateServiceImpl.java - æ¨¡æ¿æœåŠ¡å®ç°
    - createTemplate() - åˆ›å»ºæ¨¡æ¿ï¼ˆå«å®ä½“ç±»å‹åˆ—è¡¨ï¼‰
    - updateTemplate() - æ›´æ–°æ¨¡æ¿ï¼ˆç³»ç»Ÿæ¨¡æ¿ä¸å…è®¸ä¿®æ”¹ï¼‰
    - deleteTemplate() - åˆ é™¤æ¨¡æ¿ï¼ˆç³»ç»Ÿæ¨¡æ¿ä¸å…è®¸åˆ é™¤ï¼‰
    - getTemplateDetail() - è·å–æ¨¡æ¿è¯¦æƒ…
    - listTemplates() - åˆ—å‡ºç§Ÿæˆ·æ‰€æœ‰æ¨¡æ¿ï¼ˆå«ç³»ç»Ÿæ¨¡æ¿ï¼‰
    - listSystemTemplates() - åˆ—å‡ºç³»ç»Ÿé¢„ç½®æ¨¡æ¿

4. Controllerå±‚

- EntityTypeTemplateController.java - RESTful API
    - POST /v1/knowledge/entity-template - åˆ›å»ºæ¨¡æ¿
    - PUT /v1/knowledge/entity-template/{templateId} - æ›´æ–°æ¨¡æ¿
    - DELETE /v1/knowledge/entity-template/{templateId} - åˆ é™¤æ¨¡æ¿
    - GET /v1/knowledge/entity-template/{templateId} - è·å–æ¨¡æ¿è¯¦æƒ…
    - GET /v1/knowledge/entity-template - åˆ—å‡ºæ¨¡æ¿
    - GET /v1/knowledge/entity-template/system - åˆ—å‡ºç³»ç»Ÿæ¨¡æ¿

  ---
ğŸ”— çŸ¥è¯†åº“é›†æˆ

1. KnowledgeBaseå®ä½“æ›´æ–°

- æ–°å¢å­—æ®µï¼šentityTemplateId - å…³è”çš„å®ä½“ç±»å‹æ¨¡æ¿ID

2. çŸ¥è¯†åº“åˆ›å»ºé€»è¾‘

- å¦‚æœåˆ›å»ºæ—¶æŒ‡å®šäº†entityTemplateIdï¼ŒéªŒè¯å…¶æœ‰æ•ˆæ€§
- å¦‚æœæœªæŒ‡å®šï¼Œé»˜è®¤ä½¿ç”¨ç³»ç»Ÿ"åˆåŒé¢†åŸŸ"æ¨¡æ¿
- æ ¡éªŒè§„åˆ™ï¼š
    - æ¨¡æ¿å¿…é¡»å­˜åœ¨
    - å¿…é¡»å±äºå½“å‰ç§Ÿæˆ·æˆ–æ˜¯ç³»ç»Ÿæ¨¡æ¿
    - æ¨¡æ¿å¿…é¡»å¤„äºå¯ç”¨çŠ¶æ€

3. KbBuildConsumeræ›´æ–°

- ä»çŸ¥è¯†åº“è·å–entityTemplateId
- æŸ¥è¯¢æ¨¡æ¿ä¸‹çš„æ‰€æœ‰å®ä½“ç±»å‹å®šä¹‰
- æ„å»ºMap<String, String>æ ¼å¼çš„å®ä½“ç±»å‹é…ç½®
    - Key: entityCodeï¼ˆå¦‚ContractPartyï¼‰
    - Value: entityDescriptionï¼ˆå¦‚åˆåŒä¸»ä½“ï¼ˆç”²ä¹™æ–¹ï¼‰ï¼‰

  ---
ğŸ PythonæœåŠ¡é›†æˆ

1. D2KGè¯·æ±‚DTOæ›´æ–°

public class D2KGRequest {
private String contractId;          // kbId
private String contractText;        // Markdownå†…å®¹
private Map<String, String> entityTypes;  // å®ä½“ç±»å‹é…ç½®
}

2. PythonKnowledgeClientæ›´æ–°

public String buildKnowledgeGraph(
String kbId,
String mdContent,
Map<String, String> entityTypes  // æ–°å¢å‚æ•°
)

3. å‘é€ç»™Pythonçš„æ•°æ®æ ¼å¼

{
"contractId": "kb_abc123",
"contractText": "# Markdownå†…å®¹\n...",
"entityTypes": {
"ContractParty": "åˆåŒä¸»ä½“ï¼ˆç”²ä¹™æ–¹ï¼‰",
"Amount": "é‡‘é¢",
"DateTerm": "æ—¥æœŸæˆ–æœŸé™",
...
}
}

  ---
ğŸ“ ä½¿ç”¨ç¤ºä¾‹

åˆ›å»ºè‡ªå®šä¹‰å®ä½“ç±»å‹æ¨¡æ¿

è¯·æ±‚ç¤ºä¾‹ï¼š
POST /v1/knowledge/entity-template
Headers: X-TenantId: tenant_123, X-UserId: user_456

{
"name": "åŒ»ç–—é¢†åŸŸ",
"description": "é€‚ç”¨äºåŒ»ç–—æ–‡æ¡£çš„å®ä½“ç±»å‹å®šä¹‰",
"entityTypes": [
{
"entityCode": "Disease",
"entityName": "ç–¾ç—…",
"entityDescription": "ç–¾ç—…åç§°å’Œç±»å‹",
"displayOrder": 1
},
{
"entityCode": "Symptom",
"entityName": "ç—‡çŠ¶",
"entityDescription": "ä¸´åºŠç—‡çŠ¶å’Œè¡¨ç°",
"displayOrder": 2
},
{
"entityCode": "Medication",
"entityName": "è¯ç‰©",
"entityDescription": "ç”¨è¯ä¿¡æ¯",
"displayOrder": 3
}
]
}

åˆ›å»ºçŸ¥è¯†åº“æ—¶æŒ‡å®šå®ä½“ç±»å‹æ¨¡æ¿

è¯·æ±‚ç¤ºä¾‹ï¼š
POST /v1/knowledge/base
Headers: X-TenantId: tenant_123

{
"name": "æˆ‘çš„åŒ»ç–—çŸ¥è¯†åº“",
"ownerUserId": "user_456",
"scope": "PRIVATE",
"description": "å­˜å‚¨åŒ»ç–—æ–‡æ¡£",
"entityTemplateId": "template_789"  // ä½¿ç”¨è‡ªå®šä¹‰çš„"åŒ»ç–—é¢†åŸŸ"æ¨¡æ¿
}

  ---
ğŸ¯ æ ¸å¿ƒç‰¹æ€§

1. çµæ´»çš„æ¨¡æ¿ç³»ç»Ÿ
   - ç³»ç»Ÿé¢„ç½®æ¨¡æ¿ï¼ˆåˆåŒã€è®ºæ–‡ï¼‰
   - ç§Ÿæˆ·è‡ªå®šä¹‰æ¨¡æ¿
   - æ¨¡æ¿çº§åˆ«çš„æƒé™éš”ç¦»
2. å®Œæ•´çš„CRUDæ“ä½œ
   - åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤ã€æŸ¥è¯¢æ¨¡æ¿
   - æ‰¹é‡ç®¡ç†å®ä½“ç±»å‹å®šä¹‰
   - æ˜¾ç¤ºé¡ºåºæ§åˆ¶
3. çŸ¥è¯†åº“é›†æˆ
   - åˆ›å»ºçŸ¥è¯†åº“æ—¶å¯é€‰æ‹©å®ä½“ç±»å‹æ¨¡æ¿
   - æœªæŒ‡å®šæ—¶ä½¿ç”¨ç³»ç»Ÿé»˜è®¤æ¨¡æ¿
   - æ¨¡æ¿ä¸çŸ¥è¯†åº“å…³è”ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§
4. PythonæœåŠ¡é›†æˆ
   - è‡ªåŠ¨ä¼ é€’å®ä½“ç±»å‹é…ç½®åˆ°Python D2KGæœåŠ¡
   - æ”¯æŒåŠ¨æ€å®ä½“ç±»å‹å®šä¹‰
   - ä¸ç°æœ‰æµç¨‹æ— ç¼é›†æˆ
5. æ•°æ®å®‰å…¨
   - ç³»ç»Ÿæ¨¡æ¿ä¸å¯ä¿®æ”¹/åˆ é™¤
   - ç§Ÿæˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ¨¡æ¿å’Œç³»ç»Ÿæ¨¡æ¿
   - å¤–é”®çº¦æŸç¡®ä¿æ•°æ®å®Œæ•´æ€§

  ---
ğŸ“‚ æ–‡ä»¶æ¸…å•

SQLï¼š
- V2__entity_type_config.sql - æ•°æ®åº“è¡¨ç»“æ„å’Œåˆå§‹åŒ–æ•°æ®

å®ä½“ç±»ï¼š
- EntityTypeTemplate.java
- EntityTypeDefinition.java

DTOï¼š
- EntityTypeTemplateCreateRequest.java
- EntityTypeTemplateResponse.java
- EntityTypeDefinitionRequest.java
- EntityTypeDefinitionResponse.java

Mapperï¼š
- EntityTypeTemplateMapper.java
- EntityTypeDefinitionMapper.java

Serviceï¼š
- IEntityTypeTemplateService.java
- EntityTypeTemplateServiceImpl.java
- IEntityTypeDefinitionService.java
- EntityTypeDefinitionServiceImpl.java

Controllerï¼š
- EntityTypeTemplateController.java

ä¿®æ”¹çš„æ–‡ä»¶ï¼š
- KnowledgeBase.java - æ·»åŠ entityTemplateIdå­—æ®µ
- KnowledgeBaseCreateRequest.java - æ·»åŠ entityTemplateIdå­—æ®µ
- KnowledgeBaseServiceImpl.java - æ·»åŠ æ¨¡æ¿éªŒè¯é€»è¾‘
- D2KGRequest.java - æ·»åŠ entityTypeså­—æ®µ
- PythonKnowledgeClient.java - æ·»åŠ entityTypeså‚æ•°
- KbBuildConsumer.java - æŸ¥è¯¢å¹¶ä¼ é€’å®ä½“ç±»å‹é…ç½®